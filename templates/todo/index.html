{% extends "base.html" %}
{% block title %}Dashboard - Todo App{% endblock %}

{% block content %}
<div class="container py-4">

  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h4 class="fw-semibold mb-0">Your Todos</h4>
    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#todoModal">
      <i class="bi bi-plus-circle"></i> Add Todo
    </button>
  </div>

  <!-- Flash Alerts -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <!-- Todo List -->
  {% if todos %}
    <div class="row">
      {% for todo in todos %}
        <div class="col-md-4 mb-3">
          <div class="card h-100 shadow-sm border-0">

            <div class="card-body">
              <div class="d-flex justify-content-between align-items-start">
                <h5 class="card-title mb-1">{{ todo.title }}</h5>

                {% if todo.is_completed %}
                  <span class="badge bg-success">Done</span>
                {% else %}
                  <span class="badge bg-warning text-dark">Pending</span>
                {% endif %}
              </div>

              {% if todo.description %}
                <p class="text-muted small mt-2">{{ todo.description }}</p>
              {% endif %}

              <div class="mt-2">
                <span class="badge bg-secondary">
                  Priority: {{ todo.priority }}
                </span>

                {% if todo.due_date %}
                  <span class="badge bg-info text-dark ms-1">
                    Due: {{ todo.due_date }}
                  </span>
                {% endif %}
              </div>
            </div>

            <!-- Card Actions -->
            <div class="card-footer bg-white border-0 d-flex justify-content-between">
              <form method="POST" action="{{ url_for('todo', todo_id=todo.id) }}">
                <button class="btn btn-sm btn-outline-success">
                  <i class="bi bi-check2-circle"></i> Finished
                </button>
              </form>

              <div>
                <a href="{{ url_for('todo', todo_id=todo.id) }}"
                   class="btn btn-sm btn-outline-primary">
                  <i class="bi bi-pencil"></i>Edit
                </a>

                <form method="POST"
                      action="{{ url_for('todo', todo_id=todo.id) }}"
                      class="d-inline">
                  <button class="btn btn-sm btn-outline-danger"
                          onclick="return confirm('Delete this todo?')">
                    <i class="bi bi-trash"></i>Delete
                  </button>
                </form>
              </div>
            </div>

          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="text-center text-muted py-5">
      <i class="bi bi-inbox fs-1"></i>
      <p class="mt-3">No todos yet. Add your first one!</p>
    </div>
  {% endif %}

</div>

{% include "todo/todo_modal.html" %}
{% endblock %}
